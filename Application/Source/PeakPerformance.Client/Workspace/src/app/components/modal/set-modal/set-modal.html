<div class="my-backdrop"></div>
<section class="my-modal xs">
    <div class="my-modal-header">
        <h3>{{ modalType }} Set</h3>
        <i class="fa-solid fa-circle-xmark" (click)="closeModal()"></i>
    </div>

    <div class="my-modal-body">
        <form [formGroup]="form">
            @if (selectedExercise?.isCardio) {
                <div class="position-relative">
                    <label for="duration">Duration</label>
                    <div class="input-group mb-2" validation [key]="'Duration'" [errors]="errors">
                        <input type="number" class="form-control" id="duration" [placeholder]="previousSet?.durationMinutes ?? 'minutes'" aria-label="duration" aria-describedby="duration-addon" formControlName="durationMinutes" />
                        <span class="input-group-text input-addon-static" id="duration-addon">min</span>
                    </div>
                </div>
            }
            @if (selectedExercise?.isStrength) {
                <div class="position-relative">
                    <label for="weight">Weight</label>
                    <div class="input-group mb-2" validation [key]="'Weight'" [errors]="errors">
                        <input type="number" class="form-control" id="weight" [placeholder]="previousSet?.weight ?? 0" aria-label="weight" aria-describedby="weight-addon" formControlName="weight" />
                        <span class="input-group-text input-addon-static" id="weight-addon">{{ userWeightPreference | measurementUnitDescription }}</span>
                    </div>
                </div>
            }
            @if (!selectedExercise?.isCardio) {
                <div class="position-relative">
                    <label for="reps">Reps</label>
                    <div class="input-group mb-2" validation [key]="'Reps'" [errors]="errors">
                        <input type="number" class="form-control" id="reps" [placeholder]="previousSet?.reps ?? 1" aria-label="reps" aria-describedby="reps-addon" formControlName="reps" />
                    </div>
                </div>

                <div class="position-relative">
                    <label for="typeId">Type</label>
                    <select id="typeId" class="form-select mb-3" formControlName="typeId" validation [key]="'Type'" [errors]="errors">
                        @for (type of types; track type) {
                            <option [ngValue]="type.id">{{ type.description }}</option>
                        }
                    </select>
                </div>
            }
            @if (!selectedSet) {
                <div class="position-relative">
                    <label for="sets">Sets</label>
                    <div class="input-group mb-2" validation [key]="'Sets'" [errors]="errors">
                        <input type="number" class="form-control" id="sets" placeholder="1" aria-label="sets" aria-describedby="sets-addon" formControlName="sets" />
                    </div>
                </div>
            }
            @if (!selectedExercise?.isCardio && hasRpe) {
                <div class="d-flex align-items-center removable-field-container">
                    <div class="position-relative removable-field">
                        <label for="rpeTypeId">RPE</label>
                        <select id="rpeTypeId" class="form-select mb-2" formControlName="rpeTypeId" validation [key]="'Rpe'" [errors]="errors">
                            @for (rpe of rpes; track rpe) {
                                @if (rpe.id === 0) {
                                    <option [ngValue]="rpe.id">{{ rpe.description }}</option>
                                }
                                @else {
                                    <option [ngValue]="rpe.id">{{ rpe.id + ' - ' + rpe.description }}</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="remove-mark">
                        <i class="fa-solid fa-circle-xmark" (click)="hasRpe = false; removeValue('rpeTypeId')"></i>
                    </div>
                </div>  
            }
            @if (hasNotes) {
                <div class="d-flex align-items-center removable-field-container">
                    <div class="position-relative removable-field">
                        <label for="notes">Notes</label>
                        <div class="input-group mb-2" validation [key]="'Notes'" [errors]="errors">
                            <textarea class="form-control" id="notes" aria-label="notes" aria-describedby="notes-addon" formControlName="notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="remove-mark">
                        <i class="fa-solid fa-circle-xmark" (click)="hasNotes = false; removeValue('notes')"></i>
                    </div>
                </div>
            }
            @if (hasRest) {
                <div class="d-flex align-items-center removable-field-container">
                    <div class="position-relative removable-field">
                        <label for="rest">Rest</label>
                        <div class="input-group mb-2" validation [key]="'Rest'" [errors]="errors">
                            <input type="number" class="form-control" id="rest" [placeholder]="previousSet?.rest ?? 'seconds'" aria-label="rest" aria-describedby="rest-addon" formControlName="rest" />
                            <span class="input-group-text input-addon-static" id="rest-addon">sec</span>
                        </div>
                    </div>
                    <div class="remove-mark">
                        <i class="fa-solid fa-circle-xmark" (click)="hasRest = false; removeValue('rest')"></i>
                    </div>
                </div>
            }

            <div class="d-flex justify-content-start gap-2">
                @if (!selectedExercise?.isCardio && !hasRpe) {
                    <button class="btn btn-light btn-sm" (click)="hasRpe = true">
                        <i class="fa-solid fa-square-plus"></i> RPE
                    </button>
                }
                @if (!hasNotes) {
                    <button class="btn btn-light btn-sm" (click)="hasNotes = true">
                        <i class="fa-solid fa-square-plus"></i> Notes
                    </button>
                }
                @if (!hasRest) {
                    <button class="btn btn-light btn-sm" (click)="hasRest = true">
                        <i class="fa-solid fa-square-plus"></i> Rest
                    </button>
                }
            </div>
        </form>
    </div>

    <div class="my-modal-footer">
        <button class="btn btn-primary" (click)="submit()">Save</button>
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
    </div>
</section>