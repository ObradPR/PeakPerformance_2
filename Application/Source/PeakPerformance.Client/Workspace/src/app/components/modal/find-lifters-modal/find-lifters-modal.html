<div class="my-backdrop"></div>
<section class="my-modal sm">
    <div class="my-modal-header">
        <h3>Find Lifters</h3>
        <i class="fa-solid fa-circle-xmark" (click)="closeModal()"></i>
    </div>

    <div class="position-relative">
        <div class="my-modal-body">
          <form [formGroup]="form">
                <div class="filter-block">
                    <div class="input-group">
                        <span class="input-group-text input-addon-static" id="search-addon"><i class="fa-solid fa-magnifying-glass"></i></span>
                        <input type="search" class="form-control" id="search" placeholder="Find lifters..." aria-label="Search" aria-describedby="search-addon" formControlName="search" />
                    </div>

                    <div class="d-flex justify-content-end mt-2">
                      <button class="btn btn-secondary" (click)="showFilters = !showFilters;">
                        <i class="fa-solid fa-filter"></i> Filter
                      </button>
                    </div>

                    @if(showFilters) {
                      <div class="position-relative">
                        <div class="input-group mt-2 mb-2">
                          <span class="input-group-text input-addon-static">
                            <i class="fa-solid fa-mars-and-venus"></i>
                          </span>
  
                          <select id="gender" class="form-select" formControlName="genderId">
                              @for (gender of genders; track gender) {
                                  <option [ngValue]="gender.id">{{ gender.description }}</option>
                              }
                          </select>
                        </div>
                      </div>
  
                      <div class="position-relative">
                        <div class="input-group mt-2 mb-2">
                          <span class="input-group-text input-addon-static">
                            <i class="fa-solid fa-user-clock"></i>
                          </span>
  
                          <select id="ageRange" class="form-select" formControlName="ageRangeId">
                              @for (range of ageRanges; track $index) {
                                  <option [ngValue]="range.id">{{ range.description }}</option>
                              }
                          </select>
                        </div>
                      </div>
  
                      <div class="position-relative">
                        <div class="input-group mb-2">
  
                          <span class="input-group-text input-addon-static">
                              @if(selectedIso2) {
                                  <img  
                                      [src]="'https://flagsapi.com/' + selectedIso2 + '/flat/32.png'"
                                      style="height: 25px;"
                                  />
                              }
                              @else {
                                <i class="fa-solid fa-flag"></i>
                              }
                          </span>
  
                          <select id="country" class="form-select" formControlName="countryId" (change)="onCountryChanged($event)">
                            <option value="0"></option>
                              @for (country of countries; track country) {
                                  <option [value]="country.id">{{ country.name }}</option>
                              }
                          </select>
                        </div>
                      </div>
                    }
                </div>

                <!-- User list -->
                <div class="d-flex flex-column mb-1">
                    @for (user of users.data; track $index) {
                        <div class="user-item d-flex gap-3 align-items-center" (click)="selectUser(user.id)">
                          <div class="profile-image-wrapper">
                            @if (user.profilePictureUrl) {
                               <img [src]="user.profilePictureUrl" class="profile-image"/>
                            }
                            @else {
                              <div class="default-icon">
                                  <i class="fa-solid fa-user"></i>
                              </div>
                            }
                          </div>

                          <div class="flex-grow-1 d-flex flex-column justify-content-center">
                              <h4 class="username">
                                {{ user.username }}
                              </h4>
                              <p class="fs-6">
                                {{ user.fullName }}
                              </p>

                              <span class="d-flex">
                              @if (getUserCountryIso2(user.id)) {
                                <div class="short-info-block-find-lifters">
                                  <img  
                                      [src]="'https://flagsapi.com/' + getUserCountryIso2(user.id) + '/flat/32.png'"
                                      style="height: 20px;"
                                  />
                                </div>
                              }
                              @if (user.genderId) {
                                <div class="short-info-block-find-lifters">
                                  {{ user.genderId | enumName:'UserGenders'}}
                                </div>
                              }
                              @if (getUserAge(user.id)) {
                                <div class="short-info-block-find-lifters">
                                  {{ getUserAge(user.id) + ' yso' }}
                                </div>
                              }
                              @if(user.height) {
                                <div class="short-info-block-find-lifters">
                                  {{ getUserHeight(user.id) + ' ' + userHeightMeasurementPreference }}
                                </div>
                              }
                            </span>
                          </div>
                        </div>
                    }
                    <div class="d-flex justify-content-center">
                        <p-paginator (onPageChange)="onPageChange($event)" 
                            [first]="offset" 
                            [rows]="limit" 
                            [totalRecords]="users.total"
                            [showFirstLastIcon]="false" />
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="my-modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
    </div>
</section>